<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3"/>
<title>libqb: Ringbuffer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libqb
   &#160;<span id="projectnumber">0.16.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Ringbuffer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This implements a ring buffer that works in "chunks" not bytes. </p>
<p>So you write/read a complete chunk or not at all. There are two types of ring buffer normal and overwrite. Overwrite will reclaim the oldest chunks inorder to make way for new ones, the normal version will refuse to write a new chunk if the ring buffer is full.This implementation is capable of working across processes, but one process must only write and the other prrocess read.The read process will do the following: </p>
<div class="fragment"><div class="line">rb = <a class="code" href="qbrb_8h.html#ad7f0ee52204d491ddb6c5adf88e38c31" title="Create the ring buffer with the given type.">qb_rb_open</a>(<span class="stringliteral">&quot;test2&quot;</span>, 2000, <a class="code" href="qbrb_8h.html#ac893c2640e8291e6229a227a861c760c" title="The ringbuffer will be shared between processes.">QB_RB_FLAG_SHARED_PROCESS</a>|<a class="code" href="qbrb_8h.html#a3bf2613790c34f1da4da7e5d28b9f418" title="create a ring buffer (rather than open and existing one)">QB_RB_FLAG_CREATE</a>);</div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; 200; i++) {</div>
<div class="line">try_read_again:</div>
<div class="line">   l = <a class="code" href="qbrb_8h.html#aaeb042cad040e561093604ce5050f85b" title="Read the oldest chunk into data_out.">qb_rb_chunk_read</a>(rb, (<span class="keywordtype">void</span> *)out, 32, 1000);</div>
<div class="line">   <span class="keywordflow">if</span> (l &lt; 0) {</div>
<div class="line">           <span class="keywordflow">goto</span> try_read_again;</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line">...</div>
<div class="line">qb_rb_close(rb);</div>
</div><!-- fragment -->The write process will do the following: </p>
<div class="fragment"><div class="line">     rb = <a class="code" href="qbrb_8h.html#ad7f0ee52204d491ddb6c5adf88e38c31" title="Create the ring buffer with the given type.">qb_rb_open</a>(<span class="stringliteral">&quot;test2&quot;</span>, 2000, <a class="code" href="qbrb_8h.html#ac893c2640e8291e6229a227a861c760c" title="The ringbuffer will be shared between processes.">QB_RB_FLAG_SHARED_PROCESS</a>);</div>
<div class="line">     <span class="keywordflow">for</span> (i = 0; i &lt; 200; i++) {</div>
<div class="line">try_write_again:</div>
<div class="line">        l = <a class="code" href="qbrb_8h.html#a6be2cb75d70f5befe605501721086121" title="Write a chunk to the ring buffer.">qb_rb_chunk_write</a>(rb, &amp;v, <span class="keyword">sizeof</span>(v));</div>
<div class="line">        <span class="keywordflow">if</span> (l &lt; <span class="keyword">sizeof</span>(v)) {</div>
<div class="line">                <span class="keywordflow">goto</span> try_write_again;</div>
<div class="line">        }</div>
<div class="line">     }</div>
<div class="line">     ...</div>
<div class="line">     <a class="code" href="qbrb_8h.html#a676646fa5f7d2dba585a92b99f91a84c" title="Dereference the ringbuffer and if we are the last user destroy it.">qb_rb_close</a>(rb);</div>
</div><!-- fragment --><dl class="section author"><dt>Author</dt><dd>Angus Salkeld <a href="#" onclick="location.href='mai'+'lto:'+'asa'+'lk'+'eld'+'@r'+'edh'+'at'+'.co'+'m'; return false;">asalk<span style="display: none;">.nosp@m.</span>eld@<span style="display: none;">.nosp@m.</span>redha<span style="display: none;">.nosp@m.</span>t.co<span style="display: none;">.nosp@m.</span>m</a> </dd></dl>
 </p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="qbrb_8h.html" title="This implements a ring buffer that works in &quot;chunks&quot; not bytes.">qbrb.h</a> </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3
</small></address>
</body>
</html>
